# é™¤éŒ¯å ±å‘Šç¯„ä¾‹ï¼šGoogle Apps Script è³‡æ–™åºåˆ—åŒ–å¤±æ•—

æ­¤æ–‡ä»¶è¨˜éŒ„äº†ä¸€å€‹å¸¸è¦‹ä½†é›£ä»¥å¯Ÿè¦ºçš„éŒ¯èª¤ï¼šå¾Œç«¯åŸ·è¡ŒæˆåŠŸï¼Œä½†å‰ç«¯æ”¶åˆ° `null`ã€‚

## ğŸ”´ å•é¡Œæè¿° (Symptom)
å‰ç«¯å‘¼å«å¾Œç«¯å‡½å¼ `getAllScrappableItems`ï¼Œå¾Œç«¯æ—¥èªŒé¡¯ç¤ºå·²æˆåŠŸè®€å–åˆ° 3 ç­†è³‡æ–™ï¼Œä½†å‰ç«¯çš„ `withSuccessHandler` æ¥æ”¶åˆ°çš„åƒæ•¸å»æ˜¯ `null`ã€‚

**å‰ç«¯ Console Log:**
```text
ğŸš€ [é é¢è¼‰å…¥] é–‹å§‹è¼‰å…¥è³‡æ–™
âœ… [loadData] getAllScrappableItems æˆåŠŸè¿”å›
ğŸ“¦ [loadData] è¿”å›çš„è³‡æ–™: null  <-- é€™è£¡å‡ºéŒ¯
âŒ [renderDetailedTable] éŒ¯èª¤: æ¥æ”¶åˆ°çš„è³‡æ–™ç‚º null
```

**å¾Œç«¯ Execution Log:**
```text
è³‡è¨Š getAllAssets: å…±è®€å–ä¸¦æ­£è¦åŒ– 990 ç­†è³‡ç”¢ç‰©ä»¶ã€‚
è³‡è¨Š æˆåŠŸè¼‰å…¥ 3 ç­†è³‡æ–™
```

## ğŸ” è¨ºæ–·éç¨‹ (Diagnosis)
1. **æª¢æŸ¥å¾Œç«¯é‚è¼¯**ï¼šç¢ºèªå¾Œç«¯æ²’æœ‰æ‹‹å‡º Exceptionï¼Œä¸”ç¢ºå¯¦æœ‰ return å€¼ã€‚
2. **æª¢æŸ¥è³‡æ–™å‹åˆ¥**ï¼šæª¢æŸ¥ return çš„ç‰©ä»¶ä¸­åŒ…å«å“ªäº›è³‡æ–™å‹åˆ¥ã€‚
3. **ç™¼ç¾å•é¡Œ**ï¼šå›å‚³çš„ç‰©ä»¶é™£åˆ—ä¸­ï¼Œ`scrapDate` æ¬„ä½ç›´æ¥ä½¿ç”¨äº† `new Date()` ç‰©ä»¶ï¼Œæˆ–è€… `asset` ç‰©ä»¶ä¸­åŒ…å«äº† `Date` é¡å‹çš„å±¬æ€§ã€‚

## ğŸ’¡ æ ¹æœ¬åŸå›  (Root Cause)
Google Apps Script çš„ `google.script.run` åœ¨å°‡è³‡æ–™å¾ä¼ºæœå™¨ç«¯å‚³é€åˆ°å®¢æˆ¶ç«¯ï¼ˆç€è¦½å™¨ï¼‰æ™‚ï¼Œæœƒé€²è¡Œ JSON åºåˆ—åŒ–ã€‚
*   **ä¸æ”¯æ´çš„å‹åˆ¥**ï¼š`Date`, `Function`, `Map`, `Set`, `Circular References` (å¾ªç’°åƒç…§)ã€‚
*   **è¡Œç‚º**ï¼šç•¶é‡åˆ°ä¸æ”¯æ´çš„å‹åˆ¥æ™‚ï¼ŒGAS **ä¸æœƒå ±éŒ¯**ï¼Œè€Œæ˜¯ç›´æ¥å°‡æ•´å€‹å›å‚³çµæœè®Šæˆ `null`ã€‚

## âœ… è§£æ±ºæ–¹æ¡ˆ (Solution)
åœ¨å¾Œç«¯å›å‚³è³‡æ–™å‰ï¼Œå¿…é ˆå°‡æ‰€æœ‰éåŸºæœ¬å‹åˆ¥ï¼ˆPrimitivesï¼‰è½‰æ›ç‚ºå­—ä¸²ã€æ•¸å­—æˆ–å¸ƒæ—å€¼ã€‚

### âŒ éŒ¯èª¤çš„å¯«æ³•
```javascript
function getData() {
  return allAssets.map(asset => ({
    id: asset.id,
    updateTime: asset.lastModified // éŒ¯èª¤ï¼šé€™æ˜¯ä¸€å€‹ Date ç‰©ä»¶
  }));
}
```

### âœ… æ­£ç¢ºçš„å¯«æ³•
```javascript
function getData() {
  return allAssets.map(asset => ({
    id: String(asset.id), // å®‰å…¨ï¼šå¼·åˆ¶è½‰å­—ä¸²
    updateTime: asset.lastModified 
      ? Utilities.formatDate(new Date(asset.lastModified), Session.getScriptTimeZone(), "yyyy/MM/dd") 
      : "" // å®‰å…¨ï¼šè½‰ç‚ºæ ¼å¼åŒ–å­—ä¸²
  }));
}
```

## ğŸ›¡ï¸ é é˜²æªæ–½
1. åœ¨ `code.js` ä¸­ï¼Œæ‰€æœ‰ä¾›å‰ç«¯å‘¼å«çš„å‡½å¼ï¼ˆAPIï¼‰ï¼Œæœ€å¾Œä¸€æ­¥éƒ½æ‡‰è©²æ˜¯ `.map()` è½‰æ›ï¼Œç¢ºä¿è¼¸å‡ºæ ¼å¼ä¹¾æ·¨ã€‚
2. åœ¨å‰ç«¯ `withSuccessHandler` ä¸­åŠ å…¥å° `null` çš„æª¢æŸ¥ï¼Œä¸¦æç¤ºé–‹ç™¼è€…å¯èƒ½æ˜¯åºåˆ—åŒ–å•é¡Œã€‚

```javascript
// å‰ç«¯é˜²ç¦¦æ€§ç¨‹å¼ç¢¼ç¯„ä¾‹
function onSuccess(data) {
  if (// filepath: /Users/kih/Library/CloudStorage/OneDrive-Personal/æ–‡ä»¶/è²¡ç”¢è™•ç†/error_report.md
# é™¤éŒ¯å ±å‘Šç¯„ä¾‹ï¼šGoogle Apps Script è³‡æ–™åºåˆ—åŒ–å¤±æ•—

æ­¤æ–‡ä»¶è¨˜éŒ„äº†ä¸€å€‹å¸¸è¦‹ä½†é›£ä»¥å¯Ÿè¦ºçš„éŒ¯èª¤ï¼šå¾Œç«¯åŸ·è¡ŒæˆåŠŸï¼Œä½†å‰ç«¯æ”¶åˆ° `null`ã€‚

## ğŸ”´ å•é¡Œæè¿° (Symptom)
å‰ç«¯å‘¼å«å¾Œç«¯å‡½å¼ `getAllScrappableItems`ï¼Œå¾Œç«¯æ—¥èªŒé¡¯ç¤ºå·²æˆåŠŸè®€å–åˆ° 3 ç­†è³‡æ–™ï¼Œä½†å‰ç«¯çš„ `withSuccessHandler` æ¥æ”¶åˆ°çš„åƒæ•¸å»æ˜¯ `null`ã€‚

**å‰ç«¯ Console Log:**
```text
ğŸš€ [é é¢è¼‰å…¥] é–‹å§‹è¼‰å…¥è³‡æ–™
âœ… [loadData] getAllScrappableItems æˆåŠŸè¿”å›
ğŸ“¦ [loadData] è¿”å›çš„è³‡æ–™: null  <-- é€™è£¡å‡ºéŒ¯
âŒ [renderDetailedTable] éŒ¯èª¤: æ¥æ”¶åˆ°çš„è³‡æ–™ç‚º null
```

**å¾Œç«¯ Execution Log:**
```text
è³‡è¨Š getAllAssets: å…±è®€å–ä¸¦æ­£è¦åŒ– 990 ç­†è³‡ç”¢ç‰©ä»¶ã€‚
è³‡è¨Š æˆåŠŸè¼‰å…¥ 3 ç­†è³‡æ–™
```

## ğŸ” è¨ºæ–·éç¨‹ (Diagnosis)
1. **æª¢æŸ¥å¾Œç«¯é‚è¼¯**ï¼šç¢ºèªå¾Œç«¯æ²’æœ‰æ‹‹å‡º Exceptionï¼Œä¸”ç¢ºå¯¦æœ‰ return å€¼ã€‚
2. **æª¢æŸ¥è³‡æ–™å‹åˆ¥**ï¼šæª¢æŸ¥ return çš„ç‰©ä»¶ä¸­åŒ…å«å“ªäº›è³‡æ–™å‹åˆ¥ã€‚
3. **ç™¼ç¾å•é¡Œ**ï¼šå›å‚³çš„ç‰©ä»¶é™£åˆ—ä¸­ï¼Œ`scrapDate` æ¬„ä½ç›´æ¥ä½¿ç”¨äº† `new Date()` ç‰©ä»¶ï¼Œæˆ–è€… `asset` ç‰©ä»¶ä¸­åŒ…å«äº† `Date` é¡å‹çš„å±¬æ€§ã€‚

## ğŸ’¡ æ ¹æœ¬åŸå›  (Root Cause)
Google Apps Script çš„ `google.script.run` åœ¨å°‡è³‡æ–™å¾ä¼ºæœå™¨ç«¯å‚³é€åˆ°å®¢æˆ¶ç«¯ï¼ˆç€è¦½å™¨ï¼‰æ™‚ï¼Œæœƒé€²è¡Œ JSON åºåˆ—åŒ–ã€‚
*   **ä¸æ”¯æ´çš„å‹åˆ¥**ï¼š`Date`, `Function`, `Map`, `Set`, `Circular References` (å¾ªç’°åƒç…§)ã€‚
*   **è¡Œç‚º**ï¼šç•¶é‡åˆ°ä¸æ”¯æ´çš„å‹åˆ¥æ™‚ï¼ŒGAS **ä¸æœƒå ±éŒ¯**ï¼Œè€Œæ˜¯ç›´æ¥å°‡æ•´å€‹å›å‚³çµæœè®Šæˆ `null`ã€‚

## âœ… è§£æ±ºæ–¹æ¡ˆ (Solution)
åœ¨å¾Œç«¯å›å‚³è³‡æ–™å‰ï¼Œå¿…é ˆå°‡æ‰€æœ‰éåŸºæœ¬å‹åˆ¥ï¼ˆPrimitivesï¼‰è½‰æ›ç‚ºå­—ä¸²ã€æ•¸å­—æˆ–å¸ƒæ—å€¼ã€‚

### âŒ éŒ¯èª¤çš„å¯«æ³•
```javascript
function getData() {
  return allAssets.map(asset => ({
    id: asset.id,
    updateTime: asset.lastModified // éŒ¯èª¤ï¼šé€™æ˜¯ä¸€å€‹ Date ç‰©ä»¶
  }));
}
```

### âœ… æ­£ç¢ºçš„å¯«æ³•
```javascript
function getData() {
  return allAssets.map(asset => ({
    id: String(asset.id), // å®‰å…¨ï¼šå¼·åˆ¶è½‰å­—ä¸²
    updateTime: asset.lastModified 
      ? Utilities.formatDate(new Date(asset.lastModified), Session.getScriptTimeZone(), "yyyy/MM/dd") 
      : "" // å®‰å…¨ï¼šè½‰ç‚ºæ ¼å¼åŒ–å­—ä¸²
  }));
}
```

## ğŸ›¡ï¸ é é˜²æªæ–½
1. åœ¨ `code.js` ä¸­ï¼Œæ‰€æœ‰ä¾›å‰ç«¯å‘¼å«çš„å‡½å¼ï¼ˆAPIï¼‰ï¼Œæœ€å¾Œä¸€æ­¥éƒ½æ‡‰è©²æ˜¯ `.map()` è½‰æ›ï¼Œç¢ºä¿è¼¸å‡ºæ ¼å¼ä¹¾æ·¨ã€‚
2. åœ¨å‰ç«¯ `withSuccessHandler` ä¸­åŠ å…¥å° `null` çš„æª¢æŸ¥ï¼Œä¸¦æç¤ºé–‹ç™¼è€…å¯èƒ½æ˜¯åºåˆ—åŒ–å•é¡Œã€‚

```javascript
// å‰ç«¯
data === null) {
console.error("éŒ¯èª¤ï¼šæ¥æ”¶åˆ°çš„è³‡æ–™ç‚º nullã€‚è«‹æª¢æŸ¥å¾Œç«¯æ˜¯å¦å›å‚³äº† Dateã€Map æˆ– Set ç‰©ä»¶ã€‚");
return;
}
// ... æ­£å¸¸é‚è¼¯
}
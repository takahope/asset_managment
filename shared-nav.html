<style>
  .portal-nav {
    padding: 8px 15px;
    background-color: #e9ecef;
    border-radius: 8px;
    margin-bottom: 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .portal-nav-brand {
    font-weight: 600;
    color: #495057;
  }

  /* è½‰è·³å‹•ç•«ç›¸é—œæ¨£å¼ */
  @keyframes nav-spinner-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .nav-loader-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.6);
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }

  .nav-loader-overlay.active {
    display: flex;
  }

  .nav-spinner {
    border: 6px solid #f3f3f3;
    border-top: 6px solid #007bff;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: nav-spinner-spin 1s linear infinite;
  }

  .nav-loader-text {
    color: white;
    font-size: 1.1rem;
    margin-top: 20px;
    font-weight: 500;
  }
</style>

<div class="portal-nav">
  <span class="portal-nav-brand">è²¡ç”¢ç®¡ç†</span>
   <button type="button" class="btn btn-sm btn-outline-secondary" onclick="goToApply()">
      â¡ï¸ è½‰ç§»
    </button>
  <button type="button" class="btn btn-sm btn-outline-primary" onclick="goToReview()">
      âœ”ï¸ æ¥æ”¶
    </button>
  
   <button type="button" class="btn btn-sm btn-outline-info" onclick="goToLending()">
      ğŸ“¤ å‡ºå€Ÿ
    </button>
    <button type="button" class="btn btn-sm btn-outline-success" onclick="goToReturn()">
      ğŸ“¥ æ­¸é‚„
    </button>
    <button type="button" class="btn btn-sm btn-outline-danger" onclick="goToScrap()">
      ğŸ—‘ï¸ å ±å»¢
    </button>
    <button type="button" class="btn btn-sm btn-outline-danger" onclick="goToprintScrap()">
      ğŸ–¨ï¸ åˆ—å°å ±å»¢ç”³è«‹
    </button>
    <button type="button" class="btn btn-sm btn-outline-success" onclick="goToPrintTransfer()">
      ğŸ–¨ï¸ åˆ—å°è½‰ç§»è¨˜éŒ„
    </button>
    <button type="button" class="btn btn-sm btn-outline-info" onclick="goToUserState()">
      ğŸ“Š ç‹€æ…‹
    </button>
    <button type="button" class="btn btn-sm btn-outline-dark" onclick="goToUpdate()">
      âš™ï¸ æ›´æ–°
    </button>
    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="goToPortal()">
    &#8617; è¿”å›å…¥å£
  </button>
</div>

<!-- å…¨è¢å¹•è½‰è·³è¼‰å…¥å‹•ç•«é®ç½© -->
<div id="nav-loader-overlay" class="nav-loader-overlay">
  <div class="nav-spinner"></div>
  <div class="nav-loader-text">æ­£åœ¨è½‰è·³ï¼Œè«‹ç¨å€™...</div>
</div>

<script>
  // é€™å€‹å°è…³æœ¬æœƒè¢«åµŒå…¥åˆ°æ‰€æœ‰é é¢ï¼Œæä¾› goToPortal åŠŸèƒ½
  let _portalWebAppUrl = ''; // ä½¿ç”¨åº•ç·šé¿å…èˆ‡é é¢è‡ªèº«è®Šæ•¸è¡çª

  /**
   * çµ±ä¸€çš„å°è¦½è½‰è·³å‡½æ•¸ï¼ˆå¸¶è¼‰å…¥å‹•ç•«ï¼‰
   * @param {string} targetUrl - ç›®æ¨™ URL
   */
  function navigateWithLoader(targetUrl) {
    // é¡¯ç¤ºå…¨è¢å¹•è¼‰å…¥é®ç½©
    const loaderOverlay = document.getElementById('nav-loader-overlay');
    if (loaderOverlay) {
      loaderOverlay.classList.add('active');
    }

    // ç¦ç”¨æ‰€æœ‰å°è¦½æŒ‰éˆ•ï¼Œé˜²æ­¢é‡è¤‡é»æ“Š
    const navButtons = document.querySelectorAll('.portal-nav button');
    navButtons.forEach(btn => {
      btn.disabled = true;
      btn.style.opacity = '0.6';
      btn.style.cursor = 'not-allowed';
    });

    // åŸ·è¡Œé é¢è½‰è·³
    // ä½¿ç”¨ setTimeout ç¢ºä¿å‹•ç•«å·²ç¶“é¡¯ç¤º
    setTimeout(() => {
      // âš ï¸ é‡è¦ï¼šå¿…é ˆä½¿ç”¨ window.open(url, '_top') è€Œé window.location.href
      // åŸå› ï¼šGoogle Apps Script Web App å¯èƒ½åœ¨ iframe ä¸­é‹è¡Œ
      // ä½¿ç”¨ _top åƒæ•¸å¯ä»¥ï¼š
      //   1. åœ¨é ‚å±¤æ¡†æ¶ä¸­å°èˆªï¼Œè·³å‡ºæ‰€æœ‰ iframe
      //   2. ä¿æŒ Google æˆæ¬Šä¸Šä¸‹æ–‡å’Œ session
      //   3. é¿å…è§¸ç™¼è·¨åŸŸå®‰å…¨æª¢æŸ¥å°è‡´ã€Œéœ€è¦å­˜å–æ¬Šã€éŒ¯èª¤
      // åƒè€ƒï¼šCLAUDE.md â†’ Common Gotchas #8
      window.open(targetUrl, '_top');
    }, 100);
  }

  function goToPortal() {
    if (_portalWebAppUrl) {
      navigateWithLoader(_portalWebAppUrl);
    } else {
      alert('é é¢åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å€™...');
    }
  }

  // âœ¨ **æ–°å¢ï¼šå‰å¾€ apply.html çš„å‡½å¼** âœ¨
  function goToApply() {
    if (_portalWebAppUrl) {
      const applyUrl = _portalWebAppUrl + '?page=apply';
      navigateWithLoader(applyUrl);
    } else {
      alert('é é¢åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å€™...');
    }
  }

  // âœ¨ **æ–°å¢ï¼šå‰å¾€ review.html çš„å‡½å¼** âœ¨
  function goToReview() {
    if (_portalWebAppUrl) {
      const reviewUrl = _portalWebAppUrl + '?page=review';
      navigateWithLoader(reviewUrl);
    } else {
      alert('é é¢åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å€™...');
    }
  }

  // âœ¨ **æ–°å¢ï¼šå‰å¾€ lending.html çš„å‡½å¼** âœ¨
  function goToLending() {
    if (_portalWebAppUrl) {
      const lendingUrl = _portalWebAppUrl + '?page=lending';
      navigateWithLoader(lendingUrl);
    } else {
      alert('é é¢åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å€™...');
    }
  }

  // âœ¨ **æ–°å¢ï¼šå‰å¾€ return.html çš„å‡½å¼** âœ¨
  function goToReturn() {
    if (_portalWebAppUrl) {
      const returnUrl = _portalWebAppUrl + '?page=return';
      navigateWithLoader(returnUrl);
    } else {
      alert('é é¢åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å€™...');
    }
  }

  // âœ¨ **æ–°å¢ï¼šå‰å¾€ scrap.html çš„å‡½å¼** âœ¨
  function goToScrap() {
    if (_portalWebAppUrl) {
      const scrapUrl = _portalWebAppUrl + '?page=scrap';
      navigateWithLoader(scrapUrl);
    } else {
      alert('é é¢åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å€™...');
    }
  }

  // âœ¨ **æ–°å¢ï¼šå‰å¾€ printScrap.html çš„å‡½å¼** âœ¨
  function goToprintScrap() {
    if (_portalWebAppUrl) {
      const printScrapUrl = _portalWebAppUrl + '?page=printScrap';
      navigateWithLoader(printScrapUrl);
    } else {
      alert('é é¢åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å€™...');
    }
  }

  // âœ¨ **æ–°å¢ï¼šå‰å¾€ printTransfer.html çš„å‡½å¼** âœ¨
  function goToPrintTransfer() {
    if (_portalWebAppUrl) {
      const printTransferUrl = _portalWebAppUrl + '?page=printTransfer';
      navigateWithLoader(printTransferUrl);
    } else {
      alert('é é¢åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å€™...');
    }
  }

  // âœ¨ **æ–°å¢ï¼šå‰å¾€ update.html çš„å‡½å¼** âœ¨
  function goToUpdate() {
    if (_portalWebAppUrl) {
      const updateUrl = _portalWebAppUrl + '?page=update';
      navigateWithLoader(updateUrl);
    } else {
      alert('é é¢åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å€™...');
    }
  }

  function goToUserState() {
    if (_portalWebAppUrl) {
      const userStateUrl = _portalWebAppUrl + '?page=userstate';
      navigateWithLoader(userStateUrl);
    } else {
      alert('é é¢åˆå§‹åŒ–ä¸­ï¼Œè«‹ç¨å€™...');
    }
  }

  // è‡ªå‹•åœ¨èƒŒæ™¯ç²å–ä¸€æ¬¡ Portal çš„ URL
  google.script.run.withSuccessHandler(url => {
    _portalWebAppUrl = url;
  }).getAppUrl();
</script>